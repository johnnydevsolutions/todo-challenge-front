<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>My Tasks</h1>
    <div>
      <button class="btn btn-primary me-2" (click)="createTask()">
        <i class="fas fa-plus"></i> New Task
      </button>
      <button class="btn btn-outline-danger" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>

  <!-- Filter buttons -->
  <div class="btn-group mb-4">
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'all' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('all')">
      All Tasks
    </button>
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'active' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('active')">
      Active
    </button>
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'completed' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('completed')">
      Completed
    </button>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading tasks...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Task list -->
  <div *ngIf="!loading && filteredTasks.length > 0" class="card">
    <div class="card-body p-0">
      <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of filteredTasks">
            <td>{{ task.title }}</td>
            <td>{{ task.description || 'No description' }}</td>
            <td>
              <div class="form-check form-switch">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  [checked]="task.completed"
                  (change)="toggleTaskStatus(task)"
                  id="status-{{ task.id }}">
                <label class="form-check-label" for="status-{{ task.id }}">
                  {{ task.completed ? 'Completed' : 'Active' }}
                </label>
              </div>
            </td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-info" (click)="viewTaskDetails(task.id!)">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-primary" (click)="editTask(task.id!)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="deleteTask(task.id!)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && filteredTasks.length === 0" class="card">
    <div class="card-body text-center py-5">
      <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
      <h4>No tasks found</h4>
      <p class="text-muted">
        {{ currentFilter === 'all' ? 'You don\'t have any tasks yet.' : 
           currentFilter === 'active' ? 'You don\'t have any active tasks.' : 
           'You don\'t have any completed tasks.' }}
      </p>
      <button class="btn btn-primary mt-3" (click)="createTask()">
        <i class="fas fa-plus"></i> Create a Task
      </button>
    </div>
  </div>
</div>
