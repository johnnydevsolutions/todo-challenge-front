<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Minhas Tarefas</h1>
    <div>
      <button class="btn btn-primary me-2" (click)="createTask()">
        <i class="fas fa-plus"></i> Nova Tarefa
      </button>
      <button class="btn btn-outline-danger" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>
  </div>

  <!-- Filter buttons -->
  <div class="btn-group mb-4">
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'all' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('all')">
      Todas as Tarefas
    </button>
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'active' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('active')">
      Pendentes
    </button>
    <button 
      class="btn" 
      [ngClass]="currentFilter === 'completed' ? 'btn-primary' : 'btn-outline-primary'"
      (click)="applyFilter('completed')">
      Concluídas
    </button>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Carregando tarefas...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Task list -->
  <div class="card">
    <div class="card-body p-0">
      <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Título</th>
            <th>Descrição</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of filteredTasks" [ngClass]="{'completed-task': task.completed}">
            <td>{{ task.title }}</td>
            <td>{{ task.description || 'Sem descrição' }}</td>
            <td>
              <div class="form-check form-switch">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  [checked]="task.completed"
                  (change)="toggleTaskStatus(task)"
                  id="status-{{ task.id }}">
                <label class="form-check-label" for="status-{{ task.id }}">
                  {{ task.completed ? 'Concluída' : 'Pendente' }}
                </label>
              </div>
            </td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-info" (click)="viewTaskDetails(task.id!)">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-primary" (click)="editTask(task.id!)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="deleteTask(task.id!)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && filteredTasks.length === 0" class="text-center py-5">
    <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
    <h4>Nenhuma tarefa encontrada</h4>
    <p class="text-muted">
      {{ currentFilter === 'all' ? 'Você ainda não tem nenhuma tarefa.' : 
         currentFilter === 'active' ? 'Você não tem nenhuma tarefa pendente.' : 
         'Você não tem nenhuma tarefa concluída.' }}
    </p>
    <button class="btn btn-primary mt-3" (click)="createTask()">
      <i class="fas fa-plus"></i> Criar uma Tarefa
    </button>
  </div>
</div>
